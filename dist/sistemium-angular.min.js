"use strict";!function(e){e.module("sistemium.config",[]).value("sistemium.config",{debug:!0}),e.module("sistemium.directives",[]),e.module("sistemium.filters",[]),e.module("sistemium.services",[]),e.module("sistemium.models",[]),e.module("sistemium.dependencies",["toastr","js-data","ui.router.stateHelper"]),e.module("sistemium",["sistemium.dependencies","sistemium.config","sistemium.directives","sistemium.filters","sistemium.services","sistemium.models"])}(angular),function(){angular.module("sistemium.models").config(function(e){angular.extend(e.defaults,{beforeInject:function(e,t){t.id||(t.id=uuid.v4())},beforeCreate:function(e,t,n){t.id||(t.id=uuid.v4()),n(null,t)}})}).config(function(e){angular.extend(e.defaults,{httpConfig:{headers:{"X-Return-Post":"true",authorization:window.localStorage.getItem("authorization"),"X-Page-Size":300}},queryTransform:function(e,t){var n={};return t.offset&&(n["x-start-page:"]=Math.ceil(t.offset/t.limit)),t.limit&&(n["x-page-size:"]=t.limit),delete t.limit,delete t.offset,angular.extend(n,t)}})})}(),function(){function e(e){angular.extend(e,{allowHtml:!0,timeOut:3e3,positionClass:"toast-top-right",preventDuplicates:!1,progressBar:!1,iconClasses:{error:"alert alert-danger",info:"alert alert-info",success:"alert alert-success",warning:"alert alert-warning"}})}angular.module("sistemium.dependencies").config(e)}(),function(){function e(e,t){function n(n,r,a){var i=a.changeClass;n.$watch(a.saAnimateOnChange,function(n,a){n!==a&&e.addClass(r,i).then(function(){t(function(){e.removeClass(r,i)})})})}return{restrict:"A",replace:!0,link:n}}angular.module("sistemium.directives").directive("saAnimateOnChange",e)}(),function(){angular.module("sistemium.directives").directive("saTypeaheadClickOpen",function(e){return{require:"ngModel",link:function(t,n){var r=function(){var t=n.controller("ngModel"),r=t.$modelValue||"";r?(t.$setViewValue(""),e(function(){t.$setViewValue(r)})):t.$setViewValue(" ")};n.bind("click",r)}}})}(),function(){function e(){function e(e){return window.debug(e)}return{log:e}}angular.module("sistemium.services").service("saDebug",e)}(),function(){angular.module("sistemium.services").factory("saFormlyConfigService",function(){function e(e){if(a.hasOwnProperty(e))return a[e];throw new Error("No such key "+e+" in formlyConfig...")}function t(e,t){a[e]=t}function n(){return a}function r(e,t){return _.find(e,function(e){return e.key===t})}var a={};return{getConfigFieldsByKey:e,setConfig:t,getAll:n,getConfigKey:r}})}(),function(){angular.module("sistemium.services").factory("saHttpStatusService",function(){return{getStatusCodeText:function(e){var t="";switch(parseInt(e.toString(),10)){case 100:t="Continue";break;case 101:t="Switching Protocols";break;case 102:t="Processing (WebDAV; RFC 2518)";break;case 200:t="OK";break;case 201:t="Created";break;case 202:t="Accepted";break;case 203:t="Non-Authoritative Information (since HTTP/1.1)";break;case 204:t="No Content";break;case 205:t="Reset Content";break;case 206:t="Partial Content";break;case 207:t="Multi-Status (WebDAV; RFC 4918)";break;case 208:t="Already Reported (WebDAV; RFC 5842)";break;case 226:t="IM Used (RFC 3229)";break;case 300:t="Multiple Choices";break;case 301:t="Moved Permanently";break;case 302:t="Found";break;case 303:t="See Other";break;case 304:t="Not Modified";break;case 305:t="Use Proxy";break;case 306:t="Switch Proxy";break;case 307:t="Temporary Redirect";break;case 308:t="Permanent Redirect (Experimental RFC; RFC 7238)";break;case 400:t="Bad Request";break;case 401:t="Unauthorized";break;case 402:t="Payment Required";break;case 403:t="Forbidden";break;case 404:t="Not Found";break;case 405:t="Method Not Allowed";break;case 406:t="Not Acceptable";break;case 407:t="Proxy Authentication Required";break;case 408:t="Request Timeout";break;case 409:t="Conflict";break;case 410:t="Gone";break;case 411:t="Length Required";break;case 412:t="Precondition Failed";break;case 413:t="Request Entity Too Large";break;case 414:t="Request-URI Too Long";break;case 415:t="Unsupported Media Type";break;case 416:t="Requested Range Not Satisfiable";break;case 417:t="Expectation Failed";break;case 418:t="I'm a teapot (RFC 2324)";break;case 419:t="Authentication Timeout (not in RFC 2616)";break;case 420:t="Method Failure (Spring Framework) / Enhance Your Calm (Twitter)";break;case 422:t="Unprocessable Entity (WebDAV; RFC 4918)";break;case 423:t="Locked (WebDAV; RFC 4918)";break;case 424:t="Failed Dependency (WebDAV; RFC 4918)";break;case 426:t="Upgrade Required";break;case 428:t="Precondition Required (RFC 6585)";break;case 429:t="Too Many Requests (RFC 6585)";break;case 431:t="Request Header Fields Too Large (RFC 6585)";break;case 440:t="Login Timeout (Microsoft)";break;case 444:t="No Response (Nginx)";break;case 449:t="Retry With (Microsoft)";break;case 450:t="Blocked by Windows Parental Controls (Microsoft)";break;case 451:t="Unavailable For Legal Reasons (Internet draft) / Redirect (Microsoft)";break;case 494:t="Request Header Too Large (Nginx)";break;case 495:t="Cert Error (Nginx)";break;case 496:t="No Cert (Nginx)";break;case 497:t="HTTP to HTTPS (Nginx)";break;case 498:t="Token expired/invalid (Esri)";break;case 499:t="Client Closed Request (Nginx) / Token required (Esri)";break;case 500:t="Internal Server Error";break;case 501:t="Not Implemented";break;case 502:t="Bad Gateway";break;case 503:t="Service Unavailable";break;case 504:t="Gateway Timeout";break;case 505:t="HTTP Version Not Supported";break;case 506:t="Variant Also Negotiates (RFC 2295)";break;case 507:t="Insufficient Storage (WebDAV; RFC 4918)";break;case 508:t="Loop Detected (WebDAV; RFC 5842)";break;case 509:t="Bandwidth Limit Exceeded (Apache bw/limited extension)";break;case 510:t="Not Extended (RFC 2774)";break;case 511:t="Network Authentication Required (RFC 6585)";break;case 520:t="Origin Error (Cloudflare)";break;case 521:t="Web server is down (Cloudflare)";break;case 522:t="Connection timed out (Cloudflare)";break;case 523:t="Proxy Declined Request (Cloudflare)";break;case 524:t="A timeout occurred (Cloudflare)";break;case 598:t="Network read timeout error (Unknown)";break;case 599:t="Network connect timeout error (Unknown)";break;default:t="Unknown HTTP status '"+e+"', what is this?"}return t}}})}(),function(){angular.module("sistemium.services").factory("saMessageService",function(e){function t(t,n,r,a,i){n=n||"",r=r||{},e[i](t,n,_.assign(a,r))}var n={};return n.success=function(e,n,r){var a={timeOut:2e3};t(e,n,r,a,"success")},n.info=function(e,n,r){var a={timeout:3e3};t(e,n,r,a,"info")},n.warning=function(e,n,r){var a={timeout:3e3};t(e,n,r,a,"warning")},n.error=function(e,n,r){var a={timeout:4e3};t(e,n,r,a,"error")},n})}(),function(){angular.module("sistemium.services").service("saNgTable",function(e){function t(e){var t={"x-page-size:":e&&e.count()||12,"x-start-page:":e&&e.page()||1};if(e&&e.sorting()){var n=_.reduce(e.sorting(),function(e,t,n){return e+","+("desc"===t?"-":"")+n},"").substr(1);n&&(t["x-order-by:"]=n)}return t}function n(e,n){return function(o,s){var c,u,l=t(s),d=!i||_.get(l,"searchFor:")!==_.get(r,"searchFor:");d&&(c=n.getCount(_.pick(l,["searchFor:","searchFields:"])).then(function(t){return e.ngTableParams.total(i=t),t<(s.page()-1)*s.count()&&(l["x-start-page:"]=1,u=1),l}),c.catch(function(){o.reject()}));var f=function(){var t=l;return _.matches(t)(e.lastFindAllParams)&&_.matches(e.lastFindAllParams)(t)?(u&&s.page(u),o.resolve(a),void 0):n.findAll(t,{bypassCache:!0}).then(function(e){u&&s.page(u),r=t,a=e,o.resolve(a)},function(){o.reject()})};e.busy=c?c.then(f):f(l)}}var r={},a=[],i=0;return{setup:function(t,r){var i=!t.ngTable.noPages&&(t.ngTable.counts||[12,25,50,100]),o=t.ngTable.count||12;return i.indexOf(o)<0&&(i.push(o),i=_.sortBy(i)),t.ngTableParams=new e(angular.extend({page:1,count:o,clearData:function(){a=[]}},t.ngTable),{filterDelay:0,dataset:a,counts:i,getData:n(t,r)}),t.ngTableParams},ngTableToV4Params:t}})}(),angular.module("sistemium.services").service("saSchema",function(e,t){var n=function(e){return{sumFn:function(t){return _.reduce(t,function(t,n){return t+n[e]()},0)},sum:function(t){return _.reduce(t,function(t,n){return t+n[e]},0)},custom:function(t,n,r){return _.reduce(t,function(t,r){return n(t,r[e]())},r)}}},r=function(e,t){return function(r,a){var i={};return _.each(e,function(e){i[e]=function(){return n(e)[t](r[a])}}),i}};return function(a){var i={};return{register:function(n){var o=i[n.name]=e.defineResource(n);return n.methods&&(o.agg=r(Object.keys(n.methods),"sumFn")),o.getCount=function(e){return a.getCount.apply(this,e)},o.findAllWithRelations=function(e,n){return function(r){return t(function(a,i){o.findAll(e,n).then(function(e){var n=[];_.each(e,function(e){n.push(o.loadRelations(e,r))}),t.all(n).then(function(e){console.log(e),a()}).catch(function(e){i(e)})}).catch(function(e){i(e)})})}},o},models:function(){return i},model:function(e){return i[e]},aggregate:n}}}),angular.module("sistemium.services").service("saSockets",function(e,t){function n(e){u.io.uri=e.url.socket,u.open(),c=e.jsDataPrefix||""}function r(t,n){var r=function(){var t=arguments;e.$apply(function(){n.apply(u,t)})};return u.on(t,r),function(){u.removeListener(t,r)}}function a(t,n,r){if(angular.isFunction(n)&&!r){if(!u.connected)return n.apply(u,[{error:"Нет подключения к серверу"}]);u.emit(t,function(){var t=arguments;e.$apply(function(){n&&n.apply(u,t)})})}else u.emit(t,n,function(){var t=arguments;e.$apply(function(){r&&r.apply(u,t)})})}function i(e,n){var r=t.defer();return a(e,n,function(e){e?e.data?r.resolve(e.data):e.error&&r.reject(e):r.resolve()}),r.promise}function o(e,t){return r(e,function(e){angular.isString(e.resource)&&(e.resource=e.resource.replace(c,"")),t(e)})}function s(e){var t={id:!0,originalFilter:e,filter:_.map(e,function(e){return c+e})};return l.push(t),i("jsData:subscribe",t.filter).then(function(e){t.id=e}),function(){t.id&&(a("jsData:unsubscribe",t.id),l.splice(l.indexOf(t),1))}}var c,u=window.io({autoConnect:!1,path:"/socket.io-client"}),l=[];return e.$on("$destroy",e.$on("socket:authorized",function(){_.each(l,function(e){e.id&&i("jsData:subscribe",e.filter).then(function(t){e.id=t})})})),{io:u,init:n,emit:a,emitQ:i,on:r,jsDataSubscribe:s,onJsData:o,removeAllListeners:function(){u.removeAllListeners()},removeListener:function(e,t){u.removeListener(e,t)}}});