"use strict";!function(e){e.module("sistemium.config",[]).value("sistemium.config",{debug:!0}),e.module("sistemium.directives",[]),e.module("sistemium.filters",[]),e.module("sistemium.services",[]),e.module("sistemium.models",[]),e.module("sistemium.dependencies",["toastr","js-data","ui.router.stateHelper"]),e.module("sistemium",["sistemium.dependencies","sistemium.config","sistemium.directives","sistemium.filters","sistemium.services","sistemium.models"])}(angular),function(){angular.module("sistemium.models").config(function(e){angular.extend(e.defaults,{beforeInject:function(e,n){n.id||(n.id=uuid.v4())},beforeCreate:function(e,n,r){n.id||(n.id=uuid.v4()),r(null,n)}})}).config(function(e){angular.extend(e.defaults,{httpConfig:{headers:{"X-Return-Post":"true",authorization:window.localStorage.getItem("authorization"),"X-Page-Size":300}},queryTransform:function(e,n){var r={};return n.offset&&(r["x-start-page:"]=Math.ceil(n.offset/n.limit)),n.limit&&(r["x-page-size:"]=n.limit),delete n.limit,delete n.offset,angular.extend(r,n)}})})}(),function(){function e(e){angular.extend(e,{allowHtml:!0,timeOut:3e3,positionClass:"toast-top-right",preventDuplicates:!1,progressBar:!1,iconClasses:{error:"alert alert-danger",info:"alert alert-info",success:"alert alert-success",warning:"alert alert-warning"}})}angular.module("sistemium.dependencies").config(e)}(),function(){function e(e,n){function r(r,t,a){var i=a.changeClass;r.$watch(a.saAnimateOnChange,function(r,a){r!==a&&e.addClass(t,i).then(function(){n(function(){e.removeClass(t,i)})})})}return{restrict:"A",replace:!0,link:r}}angular.module("sistemium.directives").directive("saAnimateOnChange",e)}(),function(){angular.module("sistemium.directives").directive("saTypeaheadClickOpen",function(e){return{require:"ngModel",link:function(n,r){var t=function(){var n=r.controller("ngModel"),t=n.$modelValue||"";t?(n.$setViewValue(""),e(function(){n.$setViewValue(t)})):n.$setViewValue(" ")};r.bind("click",t)}}})}(),function(){function e(){function e(e){return window.debug(e)}return{log:e}}angular.module("sistemium.services").service("saDebug",e)}(),function(){angular.module("sistemium.services").service("saErrors",function(){function e(e,n){var r=e&&e.data&&e.data.length>0&&e.data||[e];r.forEach(function(e){t.push({type:"danger",msg:e.message||e||a.unknown(n)})})}function n(n){e(n)}function r(){t.splice(0,t.length)}var t=[],a={unknown:function(e){switch(e||"en"){case"en":return"Unknown error";case"ru":return"Неизвестная ошибка"}}};return{addError:n,clear:r,errors:t,ru:{add:function(n){e(n,"ru")}}}})}(),function(){angular.module("sistemium.services").factory("saFormlyConfigService",function(){function e(e){if(a.hasOwnProperty(e))return a[e];throw new Error("No such key "+e+" in formlyConfig...")}function n(e,n){a[e]=n}function r(){return a}function t(e,n){return _.find(e,function(e){return e.key===n})}var a={};return{getConfigFieldsByKey:e,setConfig:n,getAll:r,getConfigKey:t}})}(),function(){angular.module("sistemium.services").factory("saHttpStatusService",function(){return{getStatusCodeText:function(e){var n="";switch(parseInt(e.toString(),10)){case 100:n="Continue";break;case 101:n="Switching Protocols";break;case 102:n="Processing (WebDAV; RFC 2518)";break;case 200:n="OK";break;case 201:n="Created";break;case 202:n="Accepted";break;case 203:n="Non-Authoritative Information (since HTTP/1.1)";break;case 204:n="No Content";break;case 205:n="Reset Content";break;case 206:n="Partial Content";break;case 207:n="Multi-Status (WebDAV; RFC 4918)";break;case 208:n="Already Reported (WebDAV; RFC 5842)";break;case 226:n="IM Used (RFC 3229)";break;case 300:n="Multiple Choices";break;case 301:n="Moved Permanently";break;case 302:n="Found";break;case 303:n="See Other";break;case 304:n="Not Modified";break;case 305:n="Use Proxy";break;case 306:n="Switch Proxy";break;case 307:n="Temporary Redirect";break;case 308:n="Permanent Redirect (Experimental RFC; RFC 7238)";break;case 400:n="Bad Request";break;case 401:n="Unauthorized";break;case 402:n="Payment Required";break;case 403:n="Forbidden";break;case 404:n="Not Found";break;case 405:n="Method Not Allowed";break;case 406:n="Not Acceptable";break;case 407:n="Proxy Authentication Required";break;case 408:n="Request Timeout";break;case 409:n="Conflict";break;case 410:n="Gone";break;case 411:n="Length Required";break;case 412:n="Precondition Failed";break;case 413:n="Request Entity Too Large";break;case 414:n="Request-URI Too Long";break;case 415:n="Unsupported Media Type";break;case 416:n="Requested Range Not Satisfiable";break;case 417:n="Expectation Failed";break;case 418:n="I'm a teapot (RFC 2324)";break;case 419:n="Authentication Timeout (not in RFC 2616)";break;case 420:n="Method Failure (Spring Framework) / Enhance Your Calm (Twitter)";break;case 422:n="Unprocessable Entity (WebDAV; RFC 4918)";break;case 423:n="Locked (WebDAV; RFC 4918)";break;case 424:n="Failed Dependency (WebDAV; RFC 4918)";break;case 426:n="Upgrade Required";break;case 428:n="Precondition Required (RFC 6585)";break;case 429:n="Too Many Requests (RFC 6585)";break;case 431:n="Request Header Fields Too Large (RFC 6585)";break;case 440:n="Login Timeout (Microsoft)";break;case 444:n="No Response (Nginx)";break;case 449:n="Retry With (Microsoft)";break;case 450:n="Blocked by Windows Parental Controls (Microsoft)";break;case 451:n="Unavailable For Legal Reasons (Internet draft) / Redirect (Microsoft)";break;case 494:n="Request Header Too Large (Nginx)";break;case 495:n="Cert Error (Nginx)";break;case 496:n="No Cert (Nginx)";break;case 497:n="HTTP to HTTPS (Nginx)";break;case 498:n="Token expired/invalid (Esri)";break;case 499:n="Client Closed Request (Nginx) / Token required (Esri)";break;case 500:n="Internal Server Error";break;case 501:n="Not Implemented";break;case 502:n="Bad Gateway";break;case 503:n="Service Unavailable";break;case 504:n="Gateway Timeout";break;case 505:n="HTTP Version Not Supported";break;case 506:n="Variant Also Negotiates (RFC 2295)";break;case 507:n="Insufficient Storage (WebDAV; RFC 4918)";break;case 508:n="Loop Detected (WebDAV; RFC 5842)";break;case 509:n="Bandwidth Limit Exceeded (Apache bw/limited extension)";break;case 510:n="Not Extended (RFC 2774)";break;case 511:n="Network Authentication Required (RFC 6585)";break;case 520:n="Origin Error (Cloudflare)";break;case 521:n="Web server is down (Cloudflare)";break;case 522:n="Connection timed out (Cloudflare)";break;case 523:n="Proxy Declined Request (Cloudflare)";break;case 524:n="A timeout occurred (Cloudflare)";break;case 598:n="Network read timeout error (Unknown)";break;case 599:n="Network connect timeout error (Unknown)";break;default:n="Unknown HTTP status '"+e+"', what is this?"}return n}}})}(),function(){angular.module("sistemium.services").factory("saMessageService",function(e){function n(n,r,t,a,i){r=r||"",t=t||{},e[i](n,r,_.assign(a,t))}var r={};return r.success=function(e,r,t){var a={timeOut:2e3};n(e,r,t,a,"success")},r.info=function(e,r,t){var a={timeout:3e3};n(e,r,t,a,"info")},r.warning=function(e,r,t){var a={timeout:3e3};n(e,r,t,a,"warning")},r.error=function(e,r,t){var a={timeout:4e3};n(e,r,t,a,"error")},r})}(),function(){angular.module("sistemium.services").service("saNgTable",function(e){function n(e){var n={"x-page-size:":e&&e.count()||12,"x-start-page:":e&&e.page()||1};if(e&&e.sorting()){var r=_.reduce(e.sorting(),function(e,n,r){return e+","+("desc"===n?"-":"")+r},"").substr(1);r&&(n["x-order-by:"]=r)}return n}function r(e,r){return function(o,s){var u,c,l=n(s),d=!i||_.get(l,"searchFor:")!==_.get(t,"searchFor:");d&&(u=r.getCount(_.pick(l,["searchFor:","searchFields:"])).then(function(n){return e.ngTableParams.total(i=n),n<(s.page()-1)*s.count()&&(l["x-start-page:"]=1,c=1),l}),u.catch(function(){o.reject()}));var f=function(){var n=l;return _.matches(n)(e.lastFindAllParams)&&_.matches(e.lastFindAllParams)(n)?(c&&s.page(c),o.resolve(a),void 0):r.findAll(n,{bypassCache:!0}).then(function(e){c&&s.page(c),t=n,a=e,o.resolve(a)},function(){o.reject()})};e.busy=u?u.then(f):f(l)}}var t={},a=[],i=0;return{setup:function(n,t){var i=!n.ngTable.noPages&&(n.ngTable.counts||[12,25,50,100]),o=n.ngTable.count||12;return i.indexOf(o)<0&&(i.push(o),i=_.sortBy(i)),n.ngTableParams=new e(angular.extend({page:1,count:o,clearData:function(){a=[]}},n.ngTable),{filterDelay:0,dataset:a,counts:i,getData:r(n,t)}),n.ngTableParams},ngTableToV4Params:n}})}(),angular.module("sistemium.services").service("saSchema",function(e){var n=function(e){return{sumFn:function(n){return _.reduce(n,function(n,r){return n+r[e]()},0)},sum:function(n){return _.reduce(n,function(n,r){return n+r[e]},0)},custom:function(n,r,t){return _.reduce(n,function(n,t){return r(n,t[e]())},t)}}},r=function(e,r){return function(t,a){var i={};return _.each(e,function(e){i[e]=function(){return n(e)[r](t[a])}}),i}};return function(t){var a={};return{register:function(n){var i=a[n.name]=e.defineResource(n);return n.methods&&(i.agg=r(Object.keys(n.methods),"sumFn")),i.getCount=function(e){return t.getCount.apply(this,e)},i},models:function(){return a},model:function(e){return a[e]},aggregate:n}}}),angular.module("sistemium.services").service("saSockets",function(e,n){function r(e){c.io.uri=e.url.socket,c.open(),u=e.jsDataPrefix||""}function t(n,r){var t=function(){var n=arguments;e.$apply(function(){r.apply(c,n)})};return c.on(n,t),function(){c.removeListener(n,t)}}function a(n,r,t){if(angular.isFunction(r)&&!t){if(!c.connected)return r.apply(c,[{error:"Нет подключения к серверу"}]);c.emit(n,function(){var n=arguments;e.$apply(function(){r&&r.apply(c,n)})})}else c.emit(n,r,function(){var n=arguments;e.$apply(function(){t&&t.apply(c,n)})})}function i(e,r){var t=n.defer();return a(e,r,function(e){e?e.data?t.resolve(e.data):e.error&&t.reject(e):t.resolve()}),t.promise}function o(e,n){return t(e,function(e){angular.isString(e.resource)&&(e.resource=e.resource.replace(u,"")),n(e)})}function s(e){var n={id:!0,originalFilter:e,filter:_.map(e,function(e){return u+e})};return l.push(n),i("jsData:subscribe",n.filter).then(function(e){n.id=e}),function(){n.id&&(a("jsData:unsubscribe",n.id),l.splice(l.indexOf(n),1))}}var u,c=window.io({autoConnect:!1,path:"/socket.io-client"}),l=[];return e.$on("$destroy",e.$on("socket:authorized",function(){_.each(l,function(e){e.id&&i("jsData:subscribe",e.filter).then(function(n){e.id=n})})})),{io:c,init:r,emit:a,emitQ:i,on:t,jsDataSubscribe:s,onJsData:o,removeAllListeners:function(){c.removeAllListeners()},removeListener:function(e,n){c.removeListener(e,n)}}});